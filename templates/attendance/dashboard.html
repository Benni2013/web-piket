{% extends 'base.html' %}

{% block title %}Dashboard - Web Piket SILAB{% endblock %}

{% block content %}
<div class="row">
    <!-- Welcome Card -->
    <div class="col-md-12 mb-4">
        <div class="card">
            <div class="card-body">
                <h2>Selamat Datang, {{ user.name }}!</h2>
                <p class="text-muted mb-0">{{ today|date:"l, d F Y" }}</p>
            </div>
        </div>
    </div>
    
    <!-- Periode Status -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-body">
                <h5><i class="bi bi-calendar-range text-primary"></i> Periode Aktif</h5>
                {% if active_periode %}
                <h4 class="text-primary">{{ active_periode.nama }}</h4>
                <p class="text-muted mb-0">
                    {{ active_periode.tanggal_mulai|date:"d M Y" }} - 
                    {{ active_periode.tanggal_selesai|date:"d M Y" }}
                </p>
                {% else %}
                <p class="text-danger">Tidak ada periode aktif</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Attendance Status -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-body">
                <h5><i class="bi bi-clock-history text-success"></i> Status Piket Hari Ini</h5>
                {% if absensi_today %}
                    {% if absensi_today.jam_keluar %}
                    <span class="badge bg-secondary" style="font-size: 1.2rem;">Sudah Selesai</span>
                    <p class="mt-2 mb-0">
                        Masuk: {{ absensi_today.jam_masuk }}<br>
                        Keluar: {{ absensi_today.jam_keluar }}<br>
                        Durasi: {{ absensi_today.durasi }}
                    </p>
                    {% else %}
                    <span class="badge bg-warning" style="font-size: 1.2rem;">Sedang Piket</span>
                    <p class="mt-2 mb-0">Jam Masuk: {{ absensi_today.jam_masuk }}</p>
                    {% endif %}
                {% else %}
                <span class="badge bg-danger" style="font-size: 1.2rem;">Belum Mulai</span>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Actions -->
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0"><i class="bi bi-menu-button-wide"></i> Menu Utama</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <!-- Mulai Piket -->
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 {% if absensi_today %}bg-light{% endif %}">
                            <div class="card-body text-center">
                                <i class="bi bi-play-circle" style="font-size: 3rem; color: #28a745;"></i>
                                <h5 class="mt-3">Mulai Piket</h5>
                                {% if not absensi_today %}
                                <a href="{% url 'attendance:mulai_piket' %}" class="btn btn-success btn-custom mt-2">
                                    <i class="bi bi-play-fill"></i> Mulai
                                </a>
                                {% else %}
                                <button class="btn btn-secondary btn-custom mt-2" disabled>
                                    Sudah Mulai
                                </button>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Akhiri Piket -->
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 {% if not absensi_today or absensi_today.jam_keluar %}bg-light{% endif %}">
                            <div class="card-body text-center">
                                <i class="bi bi-stop-circle" style="font-size: 3rem; color: #dc3545;"></i>
                                <h5 class="mt-3">Akhiri Piket</h5>
                                {% if absensi_today and not absensi_today.jam_keluar %}
                                <a href="{% url 'attendance:akhiri_piket' %}" class="btn btn-danger btn-custom mt-2">
                                    <i class="bi bi-stop-fill"></i> Akhiri
                                </a>
                                {% else %}
                                <button class="btn btn-secondary btn-custom mt-2" disabled>
                                    {% if absensi_today.jam_keluar %}Sudah Selesai{% else %}Belum Mulai{% endif %}
                                </button>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Report -->
                    <div class="col-md-4 mb-3">
                        <div class="card h-100">
                            <div class="card-body text-center">
                                <i class="bi bi-file-earmark-text" style="font-size: 3rem; color: #007bff;"></i>
                                <h5 class="mt-3">Report Absensi</h5>
                                <a href="{% url 'attendance:report_absensi' %}" class="btn btn-primary btn-custom mt-2">
                                    <i class="bi bi-file-text"></i> Lihat Report
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Links -->
    <div class="col-12 mt-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-link-45deg"></i> Quick Links</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-2">
                        <a href="{% url 'face_vectors:insert' %}" class="btn btn-outline-primary w-100">
                            <i class="bi bi-person-badge"></i> Tambah Vektor Wajah
                        </a>
                    </div>
                    <div class="col-md-3 mb-2">
                        <a href="{% url 'face_vectors:update' %}" class="btn btn-outline-warning w-100">
                            <i class="bi bi-arrow-repeat"></i> Update Vektor Wajah
                        </a>
                    </div>
                    <div class="col-md-3 mb-2">
                        <a href="{% url 'piket_management:periode_list' %}" class="btn btn-outline-info w-100">
                            <i class="bi bi-calendar-range"></i> Manajemen Periode
                        </a>
                    </div>
                    <div class="col-md-3 mb-2">
                        <a href="{% url 'piket_management:jadwal_list' %}" class="btn btn-outline-success w-100">
                            <i class="bi bi-calendar3"></i> Manajemen Jadwal
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
